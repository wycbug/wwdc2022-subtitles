1
00:00:00,501 --> 00:00:08,509
♪ ♪

2
00:00:09,309 --> 00:00:11,345
Felipe：嗨 我是 Felipe

3
00:00:11,378 --> 00:00:14,081
我是 tvOS 团队
的软件工程师

4
00:00:14,114 --> 00:00:18,652
今天我很高兴与大家分享我们在
tvOS 16 中所做的改进

5
00:00:18,685 --> 00:00:22,623
可以让您更轻松地
在 App 中支持多用户

6
00:00:22,656 --> 00:00:26,460
Apple TV 是为所有人使用
而设计的

7
00:00:26,493 --> 00:00:31,899
自 tvOS 13 以来 我们一直
在改进 Apple TV 上的多用户功能

8
00:00:31,932 --> 00:00:35,802
在 tvOS 16 中
我们提供了一些新功能 可以

9
00:00:35,836 --> 00:00:38,872
让在所有 App 中
支持多用户变得更容易

10
00:00:38,906 --> 00:00:43,243
我将首先简单介绍
Apple TV 上的多用户功能

11
00:00:43,277 --> 00:00:48,582
向您展示在每个人都使用的设备上
个性化 App 是多么容易

12
00:00:48,615 --> 00:00:53,187
然后我将演示为流媒体 App 的
每个用户

13
00:00:53,220 --> 00:00:56,490
存储用户资料选择有多么简单

14
00:00:56,523 --> 00:01:00,827
最后是为您的 App
提供最适合方法的一些建议

15
00:01:00,861 --> 00:01:05,799
在 tvOS 16 中 我们让整个
家庭都能更轻松地使用 Apple TV

16
00:01:06,600 --> 00:01:09,903
当您按住 Siri Remote
上的电视按钮时

17
00:01:09,937 --> 00:01:12,339
“控制中心”就会出现

18
00:01:12,372 --> 00:01:16,844
顶部是此 Apple TV 上的
用户列表

19
00:01:16,877 --> 00:01:18,812
tvOS 16 中
有一项新功能

20
00:01:18,846 --> 00:01:21,648
让用户列表包含还没有被添加的

21
00:01:21,682 --> 00:01:23,450
iCloud 家庭成员

22
00:01:23,483 --> 00:01:27,654
让整个家庭都可以
比以往更轻松地使用 Apple TV

23
00:01:29,122 --> 00:01:32,526
在这里 Anne 还
没有出现在 Apple TV 上

24
00:01:32,559 --> 00:01:35,863
加号图标会给出建议的用户

25
00:01:35,896 --> 00:01:40,033
要让 Anne 加入
我们只需选择建议用户

26
00:01:41,835 --> 00:01:48,542
Anne 需要做的就是把 iPhone
带到 Apple TV 所在房间

27
00:01:48,575 --> 00:01:52,646
并在 iPhone 上确认连接

28
00:01:52,679 --> 00:01:54,348
仅此而已

29
00:01:54,381 --> 00:01:58,485
Anne 现在可以访问
在 Apple TV 上的数据

30
00:01:58,519 --> 00:02:02,756
现在让我们回到
Anne 的 iPhone

31
00:02:02,789 --> 00:02:06,059
我们来看看 Anne
最喜欢的视频流媒体 App

32
00:02:06,093 --> 00:02:08,695
这个 App 由整个家庭使用

33
00:02:08,729 --> 00:02:12,165
每个成员都有自己的个人资料

34
00:02:12,199 --> 00:02:15,802
当 App 首次启动时
它会显示个人资料选择器

35
00:02:15,836 --> 00:02:18,539
Anne 选择了她的个人资料

36
00:02:18,572 --> 00:02:21,475
这个 App 在个人设备上运行时

37
00:02:21,508 --> 00:02:25,979
可以简单地将首选个人资料存储在
NSUserDefaults 中

38
00:02:26,013 --> 00:02:30,350
甚至放入 CloudKit
以使其同步到所有设备

39
00:02:31,919 --> 00:02:34,888
每个家庭成员的 iPhone

40
00:02:34,922 --> 00:02:38,058
都会记住该成员的首选个人资料

41
00:02:38,091 --> 00:02:42,896
当 App 打开时
无需一直询问要使用哪版个人资料

42
00:02:42,930 --> 00:02:45,999
Apple TV 是全家人
共享的设备

43
00:02:46,033 --> 00:02:50,404
我们认为 让每个使用
Apple TV 的人都能访问

44
00:02:50,437 --> 00:02:54,007
自己的内容和数据非常重要

45
00:02:54,575 --> 00:03:01,315
在 tvOS 14 中 我们引入了
App 以当前用户身份运行的能力

46
00:03:01,348 --> 00:03:05,219
使用单个复选框添加
“以当前用户身份运行”资格

47
00:03:05,252 --> 00:03:07,454
完全不需要代码更改

48
00:03:07,487 --> 00:03:12,292
App 就可以访问每个用户的数据
就像在 iPhone 上一样

49
00:03:16,964 --> 00:03:22,102
调用这些 API 的 iOS 代码
可在 Apple TV 上按原样运行

50
00:03:22,135 --> 00:03:27,174
就像每个人都在使用
属于自己的 Apple TV

51
00:03:27,207 --> 00:03:30,844
当 App 启动时
tvOS 会处理好一切

52
00:03:30,878 --> 00:03:34,982
隐私和安全问题全部由系统处理

53
00:03:35,015 --> 00:03:38,752
“以当前用户身份运行”
资格非常适合游戏

54
00:03:38,785 --> 00:03:43,557
以及任何与个人进程有关的 App

55
00:03:43,590 --> 00:03:47,794
但是 带有个人资料的
媒体 App 则需要更多

56
00:03:47,828 --> 00:03:52,232
到目前为止 在我的例子中
跳过了一个重要部分：登录

57
00:03:52,266 --> 00:03:58,872
我们认为登录需要
尽可能简单且不那么频繁

58
00:03:58,906 --> 00:04:03,944
在 tvOS 15 中 我们
引入了一项允许人们使用 iPhone

59
00:04:03,977 --> 00:04:09,550
或 iPad 无缝登录
tvOS App 的功能

60
00:04:09,583 --> 00:04:12,019
这是一种绝佳的登录体验

61
00:04:12,052 --> 00:04:14,154
各个设备协同工作

62
00:04:14,188 --> 00:04:18,492
提供登录 Apple TV
最便捷的方式

63
00:04:18,525 --> 00:04:21,495
Apple TV 上
不直接提​​供的功能

64
00:04:21,528 --> 00:04:25,933
就像您在 iCloud Keychain 中的
密码一样 只需轻点一下即可

65
00:04:25,966 --> 00:04:29,069
想要了解如何打造出色的登录体验

66
00:04:29,102 --> 00:04:34,741
请观看 WWDC 2021 的
“简化 tvOS App 的登录”讲座

67
00:04:36,109 --> 00:04:39,546
今年我们将引入 tvOS 上

68
00:04:39,580 --> 00:04:42,049
对 OAuth 和密钥的支持

69
00:04:42,082 --> 00:04:45,152
密钥是一种出色的
全新身份验证技术

70
00:04:45,185 --> 00:04:48,722
用于替换您的 App 和
网站中的密码

71
00:04:48,755 --> 00:04:53,894
如要了解有关密钥的更多信息
请观看“认识密钥”视频

72
00:04:53,927 --> 00:04:57,431
但简单和方便并不是全部

73
00:04:57,464 --> 00:05:01,568
让登录仅仅发生一次也很重要

74
00:05:01,602 --> 00:05:05,506
为了使用“以当前用户身份运行”
实现这种最佳用户体验

75
00:05:05,539 --> 00:05:09,910
我们在 tvOS 16 中
引入了一个简单的新 API

76
00:05:09,943 --> 00:05:12,913
它是 Keychain Services
中的一个新常量

77
00:05:12,946 --> 00:05:17,484
允许 App 访问独立于
用户的“钥匙串”

78
00:05:17,518 --> 00:05:23,423
Apple TV 上的所有用户始终
可以访问使用此新密钥存储的项目

79
00:05:23,457 --> 00:05:26,293
让我们来看一个例子

80
00:05:26,326 --> 00:05:30,163
这是一种在“钥匙串”中
保存项目的方法

81
00:05:30,197 --> 00:05:33,367
带有用户名和密码

82
00:05:33,400 --> 00:05:36,403
要将项目保存到
独立于用户的“钥匙串”

83
00:05:36,436 --> 00:05:40,440
您所要做的就是向传递给函数
SecItemAdd 的属性字典

84
00:05:40,474 --> 00:05:43,810
添加一个新键

85
00:05:43,844 --> 00:05:49,850
我们只需将 true 作为
键 kSecUseUserIndependentKeychain 的值传递

86
00:05:51,084 --> 00:05:53,353
独立于用户的“钥匙串”设置好后

87
00:05:53,387 --> 00:05:58,458
您读取和写入的项目
将对所有用户可见

88
00:05:58,492 --> 00:06:01,528
新的 Keychain API

89
00:06:01,562 --> 00:06:03,664
和“以当前用户身份运行”资格的
结合

90
00:06:03,697 --> 00:06:08,335
让您的 App 享有 iPhone
和 Apple TV 的精华

91
00:06:08,368 --> 00:06:12,272
在共享设备上进行简单的
各用户数据分离

92
00:06:12,306 --> 00:06:16,677
同时保持 Apple TV
上的单点登录体验

93
00:06:16,710 --> 00:06:21,615
在 tvOS 16 中
我们已弃用手动将个人资料映射到

94
00:06:21,648 --> 00:06:24,618
TVUserManager
中系统用户的方法

95
00:06:24,651 --> 00:06:29,189
您不再需要维护
用户到个人资料的映射

96
00:06:29,223 --> 00:06:31,325
系统会为您处理

97
00:06:31,358 --> 00:06:36,763
您在 iOS 上使用的相同 API
也可以在 Apple TV 上原样使用

98
00:06:36,797 --> 00:06:39,800
这变得容易了许多

99
00:06:39,833 --> 00:06:42,436
让我通过演示来介绍实际使用情况

100
00:06:42,469 --> 00:06:47,274
我将引导您完成一个示例 App
它代表含个人资料的媒体 App

101
00:06:47,307 --> 00:06:50,978
这是我的视频流媒体 App

102
00:06:51,011 --> 00:06:55,315
目前它没有使用我谈到的任何功能

103
00:06:55,349 --> 00:07:00,821
它不以当前用户身份运行
也没有使用新的 Keychain API

104
00:07:00,854 --> 00:07:04,124
我会继续登录并向您展示

105
00:07:06,860 --> 00:07:10,531
登录后 我看到了一个
用户个人资料列表

106
00:07:10,564 --> 00:07:14,001
当前用户是 Mei
所以我选择她的个人资料

107
00:07:16,270 --> 00:07:20,807
选择个人资料会显示
Mei 可能想看的个性化内容

108
00:07:22,176 --> 00:07:26,680
晚些时候 Anne
坐在沙发上看电视

109
00:07:26,713 --> 00:07:29,082
通过长按 Siri Remote 上的

110
00:07:29,116 --> 00:07:32,486
电视按钮打开“控制中心”

111
00:07:32,519 --> 00:07:37,457
控制中心顶部是用户列表

112
00:07:37,491 --> 00:07:40,627
绿色复选标记表示当前用户

113
00:07:40,661 --> 00:07:43,897
我现在要切换到 Anne
并打开 App

114
00:07:45,566 --> 00:07:49,269
正如预想的那样
App 再次显示个人资料选择器

115
00:07:49,303 --> 00:07:51,905
所以 Anne 可以选择
自己的个人资料

116
00:07:54,174 --> 00:07:57,945
但请注意切换回 Mei 时
会发生什么

117
00:08:02,349 --> 00:08:04,651
App 仍然停留在 Anne 的
个人资料中

118
00:08:04,685 --> 00:08:08,856
它不记得 Mei 以前选择过
她首选的个人资料

119
00:08:08,889 --> 00:08:11,525
借助 tvOS 16
中的新功能

120
00:08:11,558 --> 00:08:14,228
用户体验可以大幅改善

121
00:08:14,261 --> 00:08:19,166
我希望使用该 App 的人
不必再次选择正在观看的人

122
00:08:19,199 --> 00:08:22,769
让我们转到 Xcode
我会向您展示这有多么容易

123
00:08:22,803 --> 00:08:27,074
让我的 App 以
当前用户身份执行非常简单

124
00:08:27,107 --> 00:08:31,612
我要做的就是为我 App 的
目标添加一项性能

125
00:08:31,645 --> 00:08:33,614
在我 App 的目标中

126
00:08:33,647 --> 00:08:37,451
我将转到
Signing and Capabilities 选项卡

127
00:08:37,484 --> 00:08:40,254
就在标签下 在左上角

128
00:08:40,287 --> 00:08:43,757
我将点按“添加性能”按钮

129
00:08:43,790 --> 00:08:46,393
它将打开性能列表

130
00:08:46,426 --> 00:08:49,363
我感兴趣的是“用户管理”性能

131
00:08:49,396 --> 00:08:52,165
所以我将输入“用户”来进行筛选

132
00:08:53,700 --> 00:08:57,437
现在我只需连按
要添加到我的 App 的性能

133
00:08:58,805 --> 00:09:02,509
在这里“以当前用户身份运行”
复选框

134
00:09:02,543 --> 00:09:05,512
已经默认选中

135
00:09:05,546 --> 00:09:07,981
这正是我所需要的

136
00:09:08,015 --> 00:09:11,251
使用此资格 我的 App 的
进程将始终

137
00:09:11,285 --> 00:09:13,620
以当前选择的用户启动

138
00:09:13,654 --> 00:09:17,991
系统将确保每个
用户的数据是有区别的

139
00:09:18,025 --> 00:09:20,961
所有数据包括“钥匙串”

140
00:09:20,994 --> 00:09:24,298
但是对于我的 App 而言
为每个用户配备独立的“钥匙串”

141
00:09:24,331 --> 00:09:26,900
会产生意想不到的副作用

142
00:09:26,934 --> 00:09:30,804
这将要求每个用户单独登录

143
00:09:30,838 --> 00:09:36,610
在 tvOS 16 中
我们可以在当前用户身份运行时

144
00:09:36,643 --> 00:09:39,446
保持所有用户使用一个帐户的体验

145
00:09:39,479 --> 00:09:44,885
使用新的 Keychain API
来访问独立于用户的“钥匙串”即可

146
00:09:44,918 --> 00:09:47,855
我现在去
KeychainController 类

147
00:09:47,888 --> 00:09:51,158
并用它来读写“钥匙串”

148
00:09:52,993 --> 00:09:57,231
这里的属性 baseQuery 有访问

149
00:09:57,264 --> 00:10:00,701
我 App 的认证信息时需要的键

150
00:10:00,734 --> 00:10:04,004
要更新它以便使用
独立于用户的新“钥匙串”

151
00:10:04,037 --> 00:10:07,808
我所要做的就是
在字典中添加一个新元素

152
00:10:07,841 --> 00:10:11,411
我将添加新的
kSecUseUserIndependentKeychain

153
00:10:11,445 --> 00:10:13,247
并将其设置为 true

154
00:10:15,649 --> 00:10:19,553
我只需要更改这些内容
来以使 App 与所有用户

155
00:10:19,586 --> 00:10:20,621
共享认证信息

156
00:10:20,654 --> 00:10:22,256
没有其他的了

157
00:10:22,289 --> 00:10:24,224
不过 需要注意的一个重点是

158
00:10:24,258 --> 00:10:27,361
其他所有数据仍然
是基于各个用户区别的

159
00:10:27,394 --> 00:10:29,930
就像我将要用来记住每个用户

160
00:10:29,963 --> 00:10:32,966
个人资料选择的 UserDefaults

161
00:10:34,434 --> 00:10:37,237
现在我要打开 ProfileData 类

162
00:10:37,271 --> 00:10:41,642
此文件在我的 iOS 和
tvOS 项目之间共享

163
00:10:41,675 --> 00:10:46,180
事实上 我 App 的 iOS 版本
已经在 UserDefaults 中

164
00:10:46,213 --> 00:10:48,282
存储了用户资料选择

165
00:10:48,315 --> 00:10:50,484
但仅限在 iOS 上运行时

166
00:10:50,517 --> 00:10:54,555
那是因为 iPhone 是
个人设备

167
00:10:54,588 --> 00:10:57,524
但现在我的 App
以当前用户身份运行

168
00:10:57,558 --> 00:11:00,260
让 Apple TV 可以
像个人设备一样

169
00:11:00,294 --> 00:11:05,799
我可以移除打勾的 iOS 选项 并让
代码在 Apple TV 上以相同的方式工作

170
00:11:05,832 --> 00:11:12,005
系统将确保为每个用户
使用正确的 UserDefaults

171
00:11:12,039 --> 00:11:15,542
当我运行新版本的 App 时
它以当前用户身份启动

172
00:11:15,576 --> 00:11:16,710
也就是 Mei

173
00:11:16,743 --> 00:11:20,113
Mei 登录并选择她的个人资料

174
00:11:20,147 --> 00:11:24,251
以当前用户身份运行 App 时
它运行的方式就像 Apple TV

175
00:11:24,284 --> 00:11:26,486
在那一刻是一台个人设备

176
00:11:26,520 --> 00:11:28,121
Mei 的设备

177
00:11:28,155 --> 00:11:32,526
Mei 的个人资料选择
存储在她的 UserDefaults 中

178
00:11:32,559 --> 00:11:34,561
当 Anne 观看的时候

179
00:11:34,595 --> 00:11:38,232
可以使用“控制中心”
切换到自己的用户

180
00:11:38,265 --> 00:11:41,568
系统会搭建一个用户切换 UI

181
00:11:41,602 --> 00:11:43,904
它留出了时间

182
00:11:43,937 --> 00:11:48,442
让您在重新启动之前完成最后的任务

183
00:11:48,475 --> 00:11:51,979
tvOS 现在
以 Anne 的身份重新启动 App

184
00:11:52,012 --> 00:11:54,615
现在 Apple TV 是 Anne 的设备

185
00:11:54,648 --> 00:11:58,318
登录提示跳过了
因为认证信息已存储在

186
00:11:58,352 --> 00:12:02,523
独立于用户的“钥匙串”中
所有用户都可以访问

187
00:12:02,556 --> 00:12:06,994
但是 Anne 的 UserDefaults 中
还没有存储个人资料选择

188
00:12:07,027 --> 00:12:09,062
所以个人资料选择器出现了

189
00:12:09,096 --> 00:12:14,968
选中 Anne 的个人资料
将选择保存到 UserDefaults 中

190
00:12:15,002 --> 00:12:19,706
好了 现在 Mei 和
Anne 都选择了个人资料

191
00:12:19,740 --> 00:12:21,141
切换用户时

192
00:12:21,175 --> 00:12:24,511
App 将不再显示任何插页式提示

193
00:12:24,545 --> 00:12:27,881
它将始终直接转到内容

194
00:12:27,915 --> 00:12:31,451
自动为每个人选择正确的个人资料

195
00:12:31,485 --> 00:12:32,819
每次都是如此

196
00:12:32,853 --> 00:12:36,790
这就是在 tvOS 16 中
我们如何让记住每个用户的

197
00:12:36,823 --> 00:12:39,393
个人资料变得更加容易

198
00:12:39,426 --> 00:12:43,664
使用一个简单的新 API 来
访问独立于用户的“钥匙串”

199
00:12:43,697 --> 00:12:47,968
由系统分别处理每个用户的数据

200
00:12:48,001 --> 00:12:51,605
现在您已经了解了如何
记住每个用户的个人资料选择

201
00:12:51,638 --> 00:12:55,075
而无需每个人单独登录

202
00:12:55,108 --> 00:12:58,345
让我们回顾一下 App
在 Apple TV 上的运作方式

203
00:12:58,378 --> 00:13:01,782
没有以当前用户身份运行
资格的 App

204
00:13:01,815 --> 00:13:04,952
使用“默认用户”的资源

205
00:13:04,985 --> 00:13:09,623
您可以将其视作
Apple TV 自己的资源

206
00:13:09,656 --> 00:13:14,061
切换用户对 App 的进程
没有影响

207
00:13:14,094 --> 00:13:18,332
如果您想要进行个性化
以下是我的建议

208
00:13:18,365 --> 00:13:21,201
这张表格显示了由您在

209
00:13:21,235 --> 00:13:25,839
tvOS App 上
使用的功能决定的可用性能

210
00:13:25,873 --> 00:13:29,142
如果您的 App
是媒体 App 或与之相似的

211
00:13:29,176 --> 00:13:32,212
通过个人资料显示
个性化内容的 App

212
00:13:32,246 --> 00:13:36,717
在使用 Apple TV 的
所有人之间共享一个帐户

213
00:13:36,750 --> 00:13:39,553
您可以采用“以当前
用户身份运行”的资格

214
00:13:39,586 --> 00:13:44,224
并使用独立于用户的
新 Keychain API

215
00:13:44,258 --> 00:13:48,395
如果像游戏那样
在您的 App 中个人进程非常重要

216
00:13:48,428 --> 00:13:52,266
您只需要采用
“以当前用户身份运行”的资格

217
00:13:52,299 --> 00:13:55,169
tvOS 将处理其他事务

218
00:13:55,202 --> 00:13:56,937
对于所有其他 App

219
00:13:56,970 --> 00:13:59,973
也就是向所有用户
呈现相同内容的 App

220
00:14:00,007 --> 00:14:02,242
例如食谱 App

221
00:14:02,276 --> 00:14:04,111
您就不必进行任何操作

222
00:14:04,144 --> 00:14:08,515
只需在 Xcode 中创建
一个新的 tvOS App 项目

223
00:14:08,549 --> 00:14:11,218
想要了解有关
“以当前用户身份运行”的更多信息

224
00:14:11,251 --> 00:14:14,922
请观看
我们在 WWDC 2020 的讲座

225
00:14:14,955 --> 00:14:21,161
我们相信顺畅地直接前往内容
是 tvOS App 的最佳体验

226
00:14:21,195 --> 00:14:23,830
我希望所有这些功能都可以帮助您

227
00:14:23,864 --> 00:14:26,600
在 App 中实现出色的大屏幕体验

228
00:14:26,633 --> 00:14:29,269
感谢观看 希望您享受本次大会

